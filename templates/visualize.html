<!doctype html>
<title>{{ title }}</title>
<script type="text/javascript"
        src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
<script type="text/javascript">
    var $SCRIPT_ROOT = {{ request.script_root|tojson|safe }};
</script>
{% block body %}
    <script type="text/javascript">
        function getCertaintyColor(certainty) {
            let fullHighlight;
            let defaultColor;
            if (certainty < 0) {
                return [80, 80, 80, 1.0];
            }
            const highlighted = [];
            if (certainty <= 0.5) {
                defaultColor = "{{ startColor }}".split(",");
                fullHighlight = "{{ midColor }}".split(",");
                certainty = certainty * 2;
            } else {
                defaultColor = "{{ midColor }}".split(",");
                fullHighlight = "{{ endColor }}".split(",");
                certainty = (certainty - 0.5) * 2;
            }
            for (var i=0;i<3;i++) {
                const defaultColorI = parseInt(defaultColor[i]);
                const fullHighlightI = parseInt(fullHighlight[i]);
                if (defaultColorI > fullHighlightI) {
                    highlighted.push(Math.round(defaultColorI - (defaultColorI - fullHighlightI) * certainty));
                } else {
                    highlighted.push(Math.round(defaultColorI + (fullHighlightI - defaultColorI) * certainty));
                }
            }
            highlighted.push(1.0);
            return highlighted;

        }
        $(function () {
            const update = function () {
                $.getJSON($SCRIPT_ROOT + '/loop',
                    function (data) {
                        let id;
                        let splitted;
                        for (const i in data.c) {
                            splitted = data.c[i].split("::");
                            id = splitted[0];
                            var certainty = parseFloat(splitted[1]);
                            var object = $('#C' + id);
                            object.css('background', 'rgba(' + getCertaintyColor(certainty) + ')');
                        }
                        for (const j in data.r) {
                            splitted = data.r[j].split("::");
                            id = splitted[0];
                            certainty = parseFloat(splitted[1]);
                            object = $('#R' + id);
                            object.css('stroke', 'rgba(' + getCertaintyColor(certainty) + ')');
                            object.css('strokewidth', certainty * 2 + 3.0);
                        }
                    });
            };
            setInterval(update, 500);
        });
    </script>
    <div id="title" style="
            width:100%;
            height:100px;
            left:0px;
            top:0px;
            background:rgba(0,0,0,0);
            position:fixed;"
         title="EpiSim"><h1 align="center">EpiSim</h1></div>
    {{ concept_divs|safe }}
    {{ relation_svg|safe }}
    {{ property_boxes|safe }}
    <svg x = "0" y = "0" width="800" height="1000" style="position:absolute;">
        <line id="HR"
              x1="100" y1="{{ hr }}"
              x2="700" y2="{{ hr }}"
              stroke="#000000"
              stroke-width="5">
        </line>
    </svg>


{% endblock %}
